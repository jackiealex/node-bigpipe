!function(e){function f(t,n,r){return function(i,s,o){var u=[];return this.each(function(){var a=e(this).data(n);if(typeof i=="string"){if(typeof a=="undefined")throw new Error(n+" not defined");switch(i){case"enable":a.enable();break;case"disable":a.disable();break;case"destroy":a.destroy(),e(this).removeData(n);break;case"option":o!==undefined?a.opts[s]=o:typeof s=="object"?a.opts=e.extend(a.opts,s):s?u.push(a.opts[s]):u.push(a.opts);break;case"toArray":if(n!=="sortable")return;u.push(a.toArray(s))}}else{if(a)return e.extend(a.opts,i),this;a=new t(e(this),e.extend({},r,i)),a.create(),e(this).data(n,a)}}),u.length?u.length===1?u[0]:u:this}}var t=0,n=function(){this.eventHandler=e("<div />"),this.origin=this.el=null;var t;Object.defineProperty(this,"placeholder",{get:function(){return t},set:function(e){if(t===e)return;t&&t.remove(),t=e}})};n.prototype.on=function(){return this.eventHandler.on.apply(this.eventHandler,Array.prototype.slice.call(arguments)),this},n.prototype.off=function(){return this.eventHandler.off.apply(this.eventHandler,Array.prototype.slice.call(arguments)),this},n.prototype.start=function(e,t){return this.origin=e,this.el=t,this.eventHandler.trigger("dragging:start"),this.el},n.prototype.stop=function(){this.origin=this.el=this.placeholder=null,this.eventHandler.trigger("dragging:stop")};var r=e.dragging=parent.$.dragging||new n,i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,s=function(t,n,r,s){function f(t,r){Array.prototype.slice.call(t).forEach(function(t){if(u&&o.target[0]!==e(t).parent()[0])return;e(t).is(a)&&r.call(t);if(u)return;e(n,t).each(function(){r.call(this)})})}var o=this;this.target=t;var u=n[0]===">",a=u?n.substr(1):n;this.observer=new i(function(e){o.disconnect(),e.forEach(function(e){r&&f(e.addedNodes,r),s&&f(e.removedNodes,s)}),o.observe()}),e(n,t).each(function(){r.call(this)}),this.observe()};s.prototype.disconnect=function(){this.observer.disconnect()},s.prototype.observe=function(){this.observer.observe(this.target[0],{childList:!0,subtree:!0})};var o=function(n,r){this.id=t++,this.el=e(n),this.opts=r,this.cancel=r.handle!==!1,this.connectedWith=[],this.opts.connectWith&&this.connectWith(this.opts.connectWith)};o.prototype.connectWith=function(t){var n=this,r=e(t),i=window;r[0].ownerDocument!==document&&(i=r[0].ownerDocument.defaultView),i.$(t).each(function(){var e=i.$(this);if(e[0]===n.el[0])return;var t=e.data("sortable")||e.data("droppable");t?t.connectedWith.push(n.id):e.one("sortable:create droppable:create",function(e,t){t.connectedWith.push(n.id)})})},o.prototype.create=function(){this.el.on("dragstart",e.proxy(this.start,this)).on("dragend",e.proxy(this.end,this)).prop("draggable",!0),this.el.on("mouseenter",this.opts.cancel,e.proxy(this.disable,this)).on("mouseleave",this.opts.cancel,e.proxy(this.enable,this)),this.opts.handle&&this.el.on("mouseenter",this.opts.handle,e.proxy(this.enable,this)).on("mouseleave",this.opts.handle,e.proxy(this.disable,this));var t=this;setTimeout(function(){t.el.trigger("draggable:create",t)})},o.prototype.destroy=function(){this.el.off("dragstart",this.start).off("dragend",this.end).prop("draggable",!1),this.el.off("mouseenter",this.opts.cancel,this.disable).off("mouseleave",this.opts.cancel,this.enable),this.opts.handle&&this.el.off("mouseenter",this.opts.handle,this.enable).off("mouseleave",this.opts.handle,this.disable)},o.prototype.enable=function(){this.opts.disabled=!1},o.prototype.disable=function(){this.opts.disabled=!0},o.prototype.start=function(e){if(this.opts.disabled)return!1;e=e.originalEvent||e,e.dataTransfer.effectAllowed="copy";try{e.dataTransfer.setData("text/plain","42")}catch(e){}r.start(this,this.el).addClass("dragging")},o.prototype.end=function(e){e.stopPropagation(),e.preventDefault();if(!r.el)return;this.el.removeClass("dragging"),r.stop()};var u=function(n,r){this.id=t++,this.el=e(n),this.opts=r,this.accept=!1,this.connectedWith=[]};u.prototype.create=function(){this.el.on("dragover",e.proxy(this.over,this)).on("dragenter",e.proxy(this.enter,this)).on("dragleave",e.proxy(this.leave,this)).on("drop",e.proxy(this.drop,this)),r.on("dragging:start",e.proxy(this.activate,this)).on("dragging:stop",e.proxy(this.reset,this));var t=this;setTimeout(function(){t.el.trigger("droppable:create",t)})},u.prototype.destroy=function(){this.el.off("dragover",this.over).off("dragenter",this.enter).off("dragleave",this.leave).off("drop",this.drop)},u.prototype.enable=function(){this.opts.disabled=!1},u.prototype.disable=function(){this.opts.disabled=!0},u.prototype.activate=function(e){this.accept=this.connectedWith.indexOf(r.origin.id)!==-1;if(!this.accept){var t=this.opts.accept==="*"||(typeof this.opts.accept=="function"?this.opts.accept.call(this.el[0],r.el):r.el.is(this.opts.accept));this.opts.scope!=="default"?(this.accept=r.origin.opts.scope===this.opts.scope,!this.accept&&this.opts.accept!=="*"&&(this.accept=t)):this.accept=t}if(!this.accept)return;this.opts.activeClass&&this.el.addClass(this.opts.activeClass),this.el.trigger("droppable:activate",r.el)},u.prototype.reset=function(e){if(!this.accept)return;this.opts.activeClass&&this.el.removeClass(this.opts.activeClass),this.opts.hoverClass&&this.el.removeClass(this.opts.hoverClass),this.el.trigger("droppable:deactivate",r.el)},u.prototype.enter=function(e){if(this.opts.disabled)return!1;e.stopPropagation(),e=e.originalEvent||e,r.placeholder&&(e.dataTransfer.effectAllowed!=="copyMove"||!this.opts.clone)&&r.placeholder.hide(),this.opts.hoverClass&&this.accept&&this.el.addClass(this.opts.hoverClass)},u.prototype.over=function(e){if(!this.accept||this.opts.disabled)return;e.preventDefault(),e.stopPropagation(),e=e.originalEvent||e,e.dataTransfer.dropEffect="copyMove"},u.prototype.leave=function(e){if(this.opts.disabled)return!1;this.opts.hoverClass&&this.accept&&this.el.removeClass(this.opts.hoverClass)},u.prototype.drop=function(t){if(this.opts.disabled)return!1;t.stopPropagation();if(!r.el)return;r.el.removeClass("dragging"),t.originalEvent&&(t=t.originalEvent);switch(t.dataTransfer.effectAllowed){case"copyMove":if(!this.opts.clone)break;r.el.show();case"copy":r.el=r.el.clone()}e(this.el).append(r.el.show()),this.el.trigger("droppable:receive",{item:r.el}),r.stop()};var a=function(n,r){this.id=t++,this.el=n,this.opts=r;var i;try{i=this.el.find(this.opts.items)[0].tagName}catch(s){i=/^ul|ol$/i.test(this.el.tagName)?"li":"div"}this.placeholder=e("<"+i+' class="'+this.opts.placeholder+'" />'),this.accept=this.index=this.lastEntered=null,this.lastX=this.lastY=this.direction=null,this.connectedWith=[],this.opts.connectWith&&this.connectWith(this.opts.connectWith)};a.prototype.connectWith=o.prototype.connectWith,a.prototype.create=function(){this.el.on("dragstart",this.opts.items,e.proxy(this.start,this)).on("dragenter",this.opts.items,e.proxy(this.enter,this)).on("dragover",this.opts.items,e.proxy(this.over,this)).on("dragend",this.opts.items,e.proxy(this.end,this)).on("drop",this.opts.items,e.proxy(this.drop,this)).find(this.opts.items).prop("draggable",!0),this.el.on("dragenter",e.proxy(this.enter,this)).on("dragover",e.proxy(this.over,this)).on("dragend",e.proxy(this.end,this)).on("drop",e.proxy(this.drop,this)).on("mouseenter",this.opts.cancel,e.proxy(this.disable,this)).on("mouseleave",this.opts.cancel,e.proxy(this.enable,this)),this.opts.handle&&this.el.on("mouseenter",this.opts.handle,e.proxy(this.enable,this)).on("mouseleave",this.opts.handle,e.proxy(this.disable,this)),r.on("dragging:start",e.proxy(this.activate,this)).on("dragging:stop",e.proxy(this.reset,this));var t=this;setTimeout(function(){t.el.trigger("sortable:create",t)}),this.observer=new s(this.el,this.opts.items,function(){e(this).prop("draggable",!0)},function(){var n=e(this);t.el.trigger("sortable:sort",{item:n}),t.el.trigger("sortable:update",{item:n,index:-1}),t.el.trigger("sortable:change",{item:n})})},a.prototype.destroy=function(){this.el.off("dragstart",this.opts.items,this.start).off("dragenter",this.opts.items,this.enter).off("dragover",this.opts.items,this.over).off("dragend",this.opts.items,this.end).off("drop",this.opts.items,this.drop).find(this.opts.items).prop("draggable",!1),this.el.off("dragenter",this.enter).off("dragover",this.over).off("dragend",this.end).off("drop",this.drop).off("mouseenter",this.opts.cancel,this.disable).off("mouseleave",this.opts.cancel,this.enable),this.opts.handle&&this.el.off("mouseenter",this.opts.handle,this.enable).off("mouseleave",this.opts.handle,this.disable),this.observer.disconnect()},a.prototype.enable=function(){this.opts.disabled=!1},a.prototype.disable=function(){this.opts.disabled=!0},a.prototype.activate=function(e){this.accept=r.origin.id===this.id||!!~this.connectedWith.indexOf(r.origin.id),this.isEmpty=this.el.find(this.opts.items).length===0;if(!this.accept)return;this.accept=this.opts.accept==="*"||(typeof this.opts.accept=="function"?this.opts.accept.call(this.el[0],r.el):r.el.is(this.opts.accept));if(!this.accept)return;this.opts.activeClass&&this.el.addClass(this.opts.activeClass),this.el.trigger("sortable:activate",r.el)},a.prototype.reset=function(e){if(!this.accept)return;this.opts.activeClass&&this.el.removeClass(this.opts.activeClass),this.el.trigger("sortable:deactivate",r.el)},a.prototype.start=function(t){if(this.opts.disabled)return!1;t.stopPropagation(),t=t.originalEvent||t,t.dataTransfer.effectAllowed="copyMove";try{t.dataTransfer.setData("text/plain","42")}catch(t){}r.start(this,e(t.target)).addClass("dragging"),this.index=r.el.index(),this.opts.forcePlaceholderSize&&(this.placeholder.height(parseFloat(r.el.css("height"))),this.placeholder.width(parseFloat(r.el.css("width")))),this.el.trigger("dragging:start",{item:r.el})},a.prototype.enter=function(t){if(!this.accept||this.opts.disabled)return;t.preventDefault(),t.stopPropagation();var n=t.currentTarget,i=n===this.el[0];if(n===this.placeholder[0])return;if(i&&!this.isEmpty&&this.placeholder.parent().length)return;this.opts.forcePlaceholderSize&&this.placeholder.height(parseFloat(r.el.css("height")));if(!i){t=t.originalEvent;if(this.lastEntered===n){if(!(this.direction==="down"&&(t.clientY<this.lastY||t.clientX<this.lastX)||this.direction==="up"&&(t.clientY>this.lastY||t.clientX>this.lastX)))return;this.lastEntered=null}this.lastEntered=n,this.lastX=t.clientX,this.lastY=t.clientY}r.placeholder=this.placeholder.show(),this.index!==null&&r.el.hide(),i?this.el.append(this.placeholder):(this.direction=this.placeholder.index()<e(n).index()?"down":"up",e(n)[this.direction==="down"?"after":"before"](this.placeholder)),this.el.trigger("sortable:sort",{item:r.el})},a.prototype.over=function(e){if(!this.accept||this.opts.disabled)return;e.preventDefault(),e.stopPropagation(),e=e.originalEvent||e,e.dataTransfer.effectAllowed==="copy"&&(e.dataTransfer.dropEffect="copy")},a.prototype.end=function(e){e.stopPropagation(),e.preventDefault();if(!r.el)return;this.el.trigger("sortable:beforeStop",{item:r.el}),r.el.removeClass("dragging").show(),r.stop(),this.index=null,this.el.trigger("dragging:stop")},a.prototype.drop=function(t){t.stopPropagation(),t.preventDefault();if(!r.el)return;r.el.removeClass("dragging"),t=t.originalEvent||t,t.dataTransfer.effectAllowed==="copy"&&(r.el=r.el.clone()),r.el.insertBefore(this.placeholder).show(),r.placeholder=null;var n=r.el.index();this.index===null?(this.el.trigger("sortable:receive",{item:r.el}),this.el.trigger("sortable:update",{item:r.el,index:n}),e(this.el.find(this.opts.items).get(n)).prop("draggable",!0)):n!==this.index&&this.el.trigger("sortable:update",{item:r.el,index:n}),this.el.trigger("sortable:change",{item:r.el}),this.el.trigger("sortable:beforeStop",{item:r.el}),r.origin instanceof a&&(r.origin.index=null,r.origin.el.trigger("dragging:stop")),r.stop(),this.el.trigger("dragging:stop")},a.prototype.toArray=function(t){t||(t={});var n=t.attribute||"id",r=[];return this.el.find(this.opts.items).each(function(){r.push(e(this).prop(n))}),r},e.fn.draggable=f(o,"draggable",{cancel:"input, textarea, button, select, option",connectedWith:!1,cursor:"auto",disabled:!1,handle:!1,initialized:!1,scope:"default"}),e.fn.droppable=f(u,"droppable",{accept:"*",activeClass:!1,disabled:!1,hoverClass:!1,initialized:!1,scope:"default",clone:!1}),e.fn.sortable=f(a,"sortable",{accept:"*",activeClass:!1,cancel:"input, textarea, button, select, option",connectWith:!1,disabled:!1,forcePlaceholderSize:!1,handle:!1,initialized:!1,items:"li, div",placeholder:"placeholder"})}(window.Zepto||window.jQuery)