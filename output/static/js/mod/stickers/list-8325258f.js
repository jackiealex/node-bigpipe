define(function(){function t(t){t.on("click",".update-type",function(t){var n=$(this).parents(".item"),r=n.data("id"),i=n.data("weight"),s=n.data("cachekey"),o=n.data("name"),u=n.data("size"),a=dialog({title:"修改贴纸类别",content:_.template(e,{id:r,cacheKey:s,weight:i,size:u,name:o}),okValue:"提交",cancelValue:"取消",cancel:function(){return!0},ok:function(){var e=$(this.node).find("input[name=file]").val(),t=$(this.node).find("input[name=id]").val(),n=$(this.node).find("input[name=weight]").val(),r=$(this.node).find("input[name=name]").val();return r=$.trim(r),e?$(this.node).find("form").ajaxSubmit({success:function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);utils.bubble("修改成功"),_SmartPipe_.reload()},error:function(e,t){}}):utils.api("/_bridge/admin/sticker/type/update",{method:"post",data:{id:t,cacheKey:s,weight:n,size:u,name:r}}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);utils.bubble("修改成功"),setTimeout(_SmartPipe_.reload(),5e3)}),a.close(),!0}});a.showModal()})}function i(e){e.on("click",".update",function(e){var t=$(this).parents(".item"),r=t.data("id"),i=t.data("weight"),s=t.data("cachekey"),o=t.data("vk"),u=t.data("name"),a=t.data("level"),f=t.data("show"),l=t.data("size"),c=t.data("fs"),h=dialog({title:"修改贴纸",content:_.template(n,{id:r,cachekey:s,viewkey:o,weight:i,name:u,level:a,size:l,delFlag:f,fullScreen:c}),okValue:"提交",cancelValue:"取消",cancel:function(){return!0},onshow:function(){a==1&&$(this.node).find(".type-status .button:contains(分类贴纸)").addClass("positive").siblings().removeClass("positive"),f==1&&$(this.node).find(".disable-status .button:contains(禁用)").addClass("positive").siblings().removeClass("positive"),c==1&&$(this.node).find(".fullscreen-status .button:contains(非全屏贴纸)").removeClass("positive").siblings().addClass("positive")},ok:function(){var e=$(this.node).find("input[name=imagefile]").val(),n=$(this.node).find("input[name=viewfile]").val(),r=$(this.node).find("input[name=id]").val(),i=$(this.node).find("input[name=weight]").val(),s=$(this.node).find("input[name=cachekey]").val(),o=$(this.node).find("input[name=viewkey]").val(),u=$(this.node).find("input[name=name]").val(),a=$(this.node).find(".type-status .positive").data("id"),f=$(this.node).find(".disable-status .positive").data("id"),c=$(this.node).find(".fullscreen-status .button.positive").data("type");return a==0?stickerTypeId="":a==1&&(stickerTypeId=t.data("stid")),u=$.trim(u),!e&&!n?utils.api("/_bridge/admin/sticker/update",{method:"post",data:{id:r,cacheKey:s,viewKey:o,weight:i,level:a,name:u,delFlag:f,size:l,fullScreen:c,stickerTypeId:stickerTypeId}}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);utils.bubble("修改成功"),setTimeout(window.location.reload(),2e3)}):$(this.node).find("form").ajaxSubmit({data:{level:a,delFlag:f,stickerTypeId:stickerTypeId,fullScreen:c},success:function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);utils.bubble("修改成功"),_SmartPipe_.reload()},error:function(e,t){}}),h.close(),!0}}).width("350");h.showModal()})}function s(e){e.on("click",".look-detail",function(){var e=$(this).data("view"),t=dialog({title:"预览图",content:_.template(r,{src:e})}).width("300");t.showModal()})}function o(e){t(e),i(e),s(e)}var e=['<form action="/stickers/type/update" method="post">',"<h3>如需修改图片请添加</h3>",'   <div class="ui form"><input type="hidden" name="id" value="<%= id %>">','       <div class="field">','           <div class="ui-input-image-preview">','               <img src="/static/img/icons/image-uploader.png" alt="默认图片">','               <input type="file" name="file" title="选择文件" accept="image/*" >',"           </div>","       </div>","   </div>",' <div class="field">','     <div class="ui right icon input">','         <input type="number" min="1" placeholder="权重" name="weight" value="<%= weight %>">','         <i class="resize vertical icon"></i>',"     </div>"," </div><br/>",' <div class="field">','     <div class="ui right icon input">','         <input type="text" name="name" placeholder="名称" value="<%= name %>">','         <i class="home  icon"></i>',"     </div>"," </div>","</form>"].join(""),n=['<form action="/stickers/update" method="post" id="mod-stickers">','   <div class="ui form"><input type="hidden" name="id" value="<%= id %>">','<input type="hidden" name="cachekey" value="<%= cachekey %>">','<input type="hidden" name="viewkey" value="<%= viewkey %>">','       <div class="two fields">','           <div class="field">',"           <h3>如需修改贴纸图请添加 </h3>",'               <div class="ui-input-image-preview">','                   <img src="/static/img/icons/image-uploader.png" alt="默认图片">','                   <input type="file" name="imagefile" title="选择文件" accept="image/*" >',"               </div>","           </div>",'           <div class="field">',"           <h3>如需修改预览图请添加</h3>",'               <div class="ui-input-image-preview">','                   <img src="/static/img/icons/image-uploader.png" alt="默认图片">','                   <input type="file" name="viewfile" title="选择文件" accept="image/*" >',"               </div>","           </div>","       </div>","   </div>",'   <div class="ui form">','   <div class="two fields">','       <div class="field">','           <div class="ui right icon input">','               <input type="number" min="1" placeholder="权重" name="weight" value="<%= weight %>">','               <i class="resize vertical icon"></i>',"           </div>","       </div>",'       <div class="field">','           <div class="ui right icon input">','               <input type="text" name="name" placeholder="名称" value="<%= name %>">','               <i class="home  icon"></i>',"           </div>","       </div>","    </div>","</div><br/>",'    <div class="row">','        <div class="ui buttons fullscreen-status">','            <div class="ui button positive" data-type="0">非全屏贴纸</div>','            <div class="or"></div>','            <div class="ui button" data-type="1">全屏贴纸</div>',"        </div>","    </div><br/>",'    <div class="row">','        <div class="ui buttons type-status">','            <div class="ui button positive" data-id="0">普通贴纸</div>','            <div class="or"></div>','            <div class="ui button" data-id="1">分类贴纸</div>',"        </div>","    </div><br/>",'    <div class="row">','        <div class="ui buttons disable-status">','            <div class="ui button positive" data-id="0">激活</div>','            <div class="or"></div>','            <div class="ui button" data-id="1">禁用</div>',"        </div>","    </div>","</form>"].join(""),r=['<div class="field">','    <div class="ui-input-image-preview">','        <img src="/static/img/icons/image-uploader.png" alt="默认图片">','        <input type="file" name="viewfile" title="选择文件" accept="image/*" >',"    </div>","</div>"].join(""),r=['<img src="<%= src %>" alt="">'].join("");return{init:function(){var e=$(".mod-stickers-list");o(e)}}})