define(function(){function e(e){e.on("click",".item .del",function(e){var t=$(this);utils.api("/_bridge/admin/system/message/delete",{method:"post",data:{id:t.data("id")}}).done(function(e,n){utils.bubble("删除成功！"),t.parents(".item").addClass("animated bounceOutLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).remove()})})})}function n(e){e.on("click",".edit",function(){var e=$(this).parents(".item"),n=e.data("id"),r=e.find(".content").text(),i=e.find(".jump").text(),s=$(".active").data("type"),o=dialog({title:"修改消息内容",content:_.template(t,{id:n,content:r,jump:i,type:s}),okValue:"提交",cancelValue:"取消",cancel:function(){return!0},ok:function(){var e=$(this.node).find("input[name=id]").val(),t=$(this.node).find("textarea[name=content]").val(),n=$(this.node).find("input[name=imageFile]").val();return t=$.trim(t),t?(n?$(this.node).find("form").ajaxSubmit({data:{file:n},beforeSubmit:function(){return loading=utils.loading(),!0},success:function(n,r){var o=n.data.resp.images[0].id;utils.api("/_bridge/admin/system/message/update",{method:"post",data:{id:e,content:t,jump:i,type:s,imageId:o}}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);loading.remove(),utils.bubble("修改成功"),_SmartPipe_.reload()})},error:function(){}}):utils.api("/_bridge/admin/system/message/update",{method:"post",data:{id:e,content:t,jump:i,type:s}}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);utils.bubble("修改成功"),_SmartPipe_.reload()}),o.close(),!0):(utils.bubble("描述不能为空"),!1)}});o.showModal()})}function r(e){e.on("click",".item .del-timer",function(e){var t=$(this);utils.api("/_bridge/admin/system/message/timer/cancel",{method:"post",data:{id:t.data("id")}}).done(function(e,n){utils.bubble("删除成功！"),t.parents(".item").addClass("animated bounceOutLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).remove()})})})}function i(t){e(t),n(t),r(t)}var t=['<form action="/notification/updateimg" method="post">','<div class="basic-info" style="overflow: auto;">',"	<h4>如需修改图片请添加!</h4>",'   <div class="ui form"> <input type="hidden" name="id" value="<%= id %>" />','       <div class="field">','           <div class="ui-input-image-preview">','               <img src="/static/img/icons/image-uploader.png" alt="默认图片">','               <input type="file" name="imageFile" title="选择文件" accept="image/*" >',"           </div>","       </div>","   </div>","</div>",'<link rel="stylesheet" href="/static/css/page/common/input-image-preview.css">','<div class="row description" style="margin-top:10px;">','   <div class="ui form" style="width: 280px;">','       <div class="field ui icon input">','           <textarea name="content" placeholder="描述一下"><%= content %></textarea>',"       </div>","   </div>","</div>","</form>"].join("");return{init:function(){var e=$(".mod-notification-list");i(e)}}})