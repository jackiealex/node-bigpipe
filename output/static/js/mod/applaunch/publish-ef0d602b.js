define(["mod/common/widget/suggestion"],function(e){function i(e){e.on("click",".clear-stime",function(t){var n=e.find("input[name=input-starttime]");n.val("")})}function s(e){e.on("click",".clear-etime",function(t){var n=e.find("input[name=input-endtime]");n.val("")})}function o(e){e.on("click",".btn-submit",function(){function h(){loading.remove(),t.clearForm()}function v(e,t){var n=$.Deferred();if(["to_someone","to_download","to_webview","to_nowhere"].indexOf(t)>=0)n.resolve(!0,e);else{var r=e;utils.api("/_bridge/label/get",{data:{id:r}}).done(function(e){e["node_code"]==2e4?n.resolve(!0,JSON.stringify(e.data.resp.label)):n.resolve(!1,e)})}return n.promise()}var t=e.find("form"),n=e.find("input[name=name].start-page-name"),r=e.find("input[type=file]"),i=e.find("input[name=input-starttime]"),s=e.find("input[name=input-endtime]"),o=e.find("textarea[name=description]"),u=e.find(".resource-type .positive").data("type"),a=$.trim(o.val()),f=$.trim(n.val()),l=i.val(),c=s.val();l=+(new Date(l)),c=+(new Date(c));if(!f)return utils.bubble("请输入名称");if(!r.val())return utils.bubble("请选择图片");if(!i.val())return utils.bubble("开始时间不能为空");if(!s.val())return utils.bubble("结束时间不能为空");if(c<l)return utils.bubble("结束时间不能比开始时间早哦"),s.val(""),!1;if(!a)return utils.bubble("请输入您的描述");var p=e.find(".jump-type .buttons .button.positive").data("id"),d="";if(p=="to_someone")d=e.find(".name-search-id").val();else if(p=="to_activity"||p=="to_brand")d=e.find(".label-search-id").val();else if(p=="to_download"||p=="to_webview"||p=="to_nowhere")d=e.find(".jump-url input").val();if(!d)return utils.bubble("请输入跳转目标");v(d,p).done(function(e,n){if(!e)return utils.bubble(n.msg);var r=n;t.ajaxSubmit({data:{pkg:u,startTime:l,endTime:c,type:p,link:r},beforeSubmit:function(){return loading=utils.loading(),!0},uploadProgress:function(){console.log(+(new Date))},success:function(e,t){h();if(e["node_code"]!=2e4){utils.bubble(e.data.msg);return}utils.bubble("上传成功"),_SmartPipe_.reload()},fail:function(e,t){h()}})})})}function u(n){t=new e({el:n.find(".label-search-box input"),elSuggestBox:n.find(".ui-suggestion"),url:window._NA_.api_domain+"/label/search",keyName:"name",baseParams:{page:1,limit:10,type:4},tmplSuggestItem:r,onStart:function(){this.$el.parent().addClass("loading")},onEnd:function(){this.$el.parent().removeClass("loading")},format:function(e){return e.resp.labels},itemFormat:function(e){return{id:e.id,name:$.trim(e.name),brand:e.brand,type:e.type,imgUrl:e.imgUrl||""}},onItemSelect:function(e){var t=$(e),r=t.data("id"),i=$.trim(t.text());t.addClass("animated zoomOutUp"),t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){t.remove()}),n.find(".label-search-input").val(i),n.find(".label-search-id").val(r)}})}function a(e){e.on("click",".jump-type .button",function(n){var r=$(this);if(r.hasClass("person-page"))e.find(".search-user-component").show(),e.find(".jump-url, .search-label-component").hide();else if(r.hasClass("label-activity")||r.hasClass("label-brand"))e.find(".search-label-component").show(),e.find(".jump-url, .search-user-component").hide();else if(r.hasClass("web-site")||r.hasClass("just-image"))e.find(".jump-url").show(),e.find(".search-label-component, .search-user-component").hide();r.hasClass("label-activity")?t.setOptions({baseParams:{type:4}}):r.hasClass("label-brand")&&t.setOptions({baseParams:{type:0,brand:1}})})}function f(t){new e({el:t.find(".name-search-box input"),elSuggestBox:t.find(".ui-suggestion"),url:window._NA_.api_domain+"/search/user",keyName:"name",baseParams:{key:"",page:1,limit:10},tmplSuggestItem:n,onStart:function(){this.$el.parent().addClass("loading")},onEnd:function(){this.$el.parent().removeClass("loading")},format:function(e){return e.resp.users},itemFormat:function(e){return{id:e.id,nickname:$.trim(e.nickname),headUrl:e.headUrl||""}},onItemSelect:function(e){var n=$(e),r=n.data("id"),i=$.trim(n.text());n.addClass("animated zoomOutUp"),n.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){n.remove()}),t.find(".name-search-box>input").val(i),t.find(".name-search-id").val(r)}})}function l(e){o(e),i(e),s(e),a(e)}var t=null,n=['<li class="item" data-id="<%= id %>">','    <img src="<%= headUrl %>" alt="">',"    <div><%= nickname %></div>","</li>"].join(""),r=['<li class="item" data-id="<%= id %>" data-type="<%= type %>" data-brand="<%= brand %>">','    <img src="<%= imgUrl %>" alt="">','    <div class="name"><%= name %></div>',"<% if(type == 4 || (type == 0 && brand == 1)) { %>",'   <div class="dot"></div>',"<% } %>","</li>"].join("");return{init:function(e){var t=$(".mod-applaunch");u(t),f(t),t.find(".datetimepicker").eq(0).datetimepicker({format:"Y-m-d 00:01",timepicker:!1,lang:"ch"}),t.find(".datetimepicker").eq(1).datetimepicker({format:"Y-m-d 23:59",lang:"ch",timepicker:!1}),l(t)}}})