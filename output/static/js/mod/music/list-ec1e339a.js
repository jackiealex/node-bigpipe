define(function(){function t(e){e.on("click",".btn-remove",function(t){if($(this).hasClass("disabled"))return utils.bubble("请选择行");var n=e.find(".list .select input[type=checkbox]:checked"),r=n.map(function(e,t){return utils.api("/_bridge/accompany/"+t.value,{method:"delete"})}),i=dialog({title:"删除歌曲",align:"bottom left",width:300,content:'<div style="text-align: center; font-size: 20px">你确认删除当前'+r.length+"项歌曲</div>",ok:function(){return $.when.apply(null,r.toArray()).done(function(){for(var e=0;e<arguments.length;e++){var t=arguments[e],n=[],r=[];t["node_code"]!=2e4?r.push(t):n.push(t)}utils.bubble("成功删除"+(r.length==0?"所有选中项":n.length+"项")),_SmartPipe_.reload()}),!0},cancel:function(){return!0},okValue:"提交",cancelValue:"取消"});i.showModal()})}function n(e){e.on("click",".btn-o2o",function(t){if($(this).hasClass("disabled"))return utils.bubble("请选择行");var n=e.find(".list .select input[type=checkbox]:checked"),r=n.map(function(e,t){return t.value}),i=r.toArray().join(","),s=$(this).hasClass("btn-online")?1:0,o=$(this).hasClass("btn-online")?"上线":"下线",u=dialog({title:"歌曲批量"+o,align:"bottom left",width:300,content:'<div style="text-align: center; font-size: 20px">你确认'+o+"当前"+r.length+"项歌曲</div>",ok:function(){var e=utils.loading();return utils.api("/_bridge/accompany/updatestatus/betch?status="+s+"&ids="+i,{method:"put"}).done(function(t){t["node_code"]==2e4&&(utils.bubble("成功"+o),_SmartPipe_.reload()),e.remove()}),!0},cancel:function(){return!0},okValue:"提交",cancelValue:"取消"});u.showModal()})}function r(e){e.on("click",".list tr input[type=checkbox]",function(e){e.stopPropagation()})}function i(e){e.on("click",".list tr td div[name=update_button]",function(e){var t=$(this).data("id");window.location.href="/music/modify?id="+t})}function s(e){e.on("click",".select input[type=checkbox]",function(t){this.checked?$(this).parents(".item").addClass("positive green"):$(this).parents(".item").removeClass("positive green"),e.find(".select input[type=checkbox]:checked").length>0?e.find(".btn-do .button").removeClass("disabled"):e.find(".btn-do .button").addClass("disabled")})}function o(e){e.on("click",".btn-reverse-select",function(t){var n=e.find(".list .select input[type=checkbox]").each(function(e,t){t.checked=!t.checked})})}function u(e){e.on("click",".btn-select-all",function(t){var n=e.find(".list .select input[type=checkbox]").each(function(e,t){t.checked||(t.checked=!0)})})}function a(e){e.on("click",".input i",function(e){var t=$(this).prev().val();if(!t)return e.stopPropagation(),e.preventDefault(),!1;_SmartPipe_.location("/music/list?type=0&key="+t)}),e.on("click",".input .label",function(e){_SmartPipe_.location("/admin/list")}),e.on("keyup",".input input",function(e){if(e.keyCode==13){var t=$(this).val();if(!t)return e.stopPropagation(),e.preventDefault(),!1;_SmartPipe_.location("/music/list?type=0&key="+t)}})}function f(e){e.on("click",".btn-unhot",function(t){var n=e.find(".list .select input[type=checkbox]:checked");if(n.length==0)return utils.bubble("请选择行");var r="确定所选歌曲取消热门?",i="";$.each(n,function(e,t){var n=$(this).val(),r=1e4,s=n+"|"+r;e!=0&&(i+=","),i+=s});var s=dialog({title:"歌曲批量更新",align:"bottom left",width:300,content:'<div style="text-align: center; font-size: 20px">'+r+"</div>",ok:function(){return $loading=utils.loading(),utils.api("/_bridge/accompany/updateorder/betch?params="+i,{method:"put"}).done(function(e){e["node_code"]==2e4&&(utils.bubble("已设置成功,请稍候..."),_SmartPipe_.reload()),$loading.remove()}),!0},cancel:function(){return!0},okValue:"提交",cancelValue:"取消"});s.showModal()}),e.on("click",".btn-hot",function(t){var n=$(this).attr("data"),r=e.find(".list .select input[type=checkbox]:checked");if(r.length==0)return utils.bubble("请选择行");if(n==1)var i="确定更新所选项排序?";else var i="确定将所选项设为热门?";var s="";$.each(r,function(e,t){var r=$(this).val(),i=1;n==1&&(i=$(this).parent().parent().find("input[name=data_order]").val());var o=r+"|"+i;e!=0&&(s+=","),s+=o});var o=dialog({title:"歌曲批量更新",align:"bottom left",width:300,content:'<div style="text-align: center; font-size: 20px">'+i+"</div>",ok:function(){return $loading=utils.loading(),utils.api("/_bridge/accompany/updateorder/betch?params="+s,{method:"put"}).done(function(e){e["node_code"]==2e4&&(utils.bubble("已设置成功,请稍候..."),_SmartPipe_.reload()),$loading.remove()}),!0},cancel:function(){return!0},okValue:"提交",cancelValue:"取消"});o.showModal()})}function l(e){t(e),s(e),i(e),n(e),r(e),o(e),u(e),f(e),a(e)}var e=['<form class="ui form" action="/_bridge/accompany" method="post">','    <div class="three fields">','        <div class="field">','            <label for="">名称</label>        ','            <input type="text" placeholder="名称" name="name" value="<%= name %>" />',"        </div>",'        <div class="field">','            <label for="">艺术家</label>       ','            <input type="text" placeholder="艺术家" name="artist" value="<%= artist %>" />',"        </div>",'        <div class="field">','            <label for="">专辑</label>        ','            <input type="text" placeholder="专辑" name="album" value="<%= album %>" />',"        </div>","    </div>",'    <div class="three fields">','        <div class="field">','            <label for="">所属区域</label>      ','            <select class="ui fluid dropdown" name="area" placeholder="所属区域" style="height: 32px">','                <option value="1"  selected="selected">华语</option>','                <option value="2">日韩</option>','                <option value="3">欧美</option>','                <option value="4">其他</option>','                <option value="5">粤语</option>','                <option value="6">闽南语</option>',"            </select>","        </div>",'        <div class="field">','            <label for="">曲风</label>        ','            <select class="ui fluid dropdown" name="style" placeholder="曲风" style="height: 32px">','                <option value="1" selected="selected">流行</option> ','                <option value="2">民歌</option> ','                <option value="3">摇滚</option> ','                <option value="4">校园</option> ','                <option value="5">励志</option> ','                <option value="6">影视</option> ','                <option value="7">军旅</option> ','                <option value="8">网游</option> ','                <option value="9">中国风</option> ','                <option value="10">高音</option> ','                <option value="11">伤感</option> ','                <option value="12">对唱</option> ','                <option value="13">电影等</option>',"            </select>","        </div>",'        <div class="field">','            <label for="">版权方</label>       ','            <input type="text" placeholder="版权方" name="copyright" value="<%= copyright %>" />',"        </div>","    </div>",'    <div class="four fields" style="display: none">','        <div class="field">','            <label for="">歌词类型</label>      ','            <input type="text" placeholder="歌词类型" name="lyricType" value="<%= lyricType %>" />',"        </div>",'        <div class="field">','            <label for="">文件大小</label>      ','            <input type="number" placeholder="文件大小" name="audioSize" value="<%= audioSize %>" />',"        </div>",'        <div class="field">','            <label for="">时长</label>        ','            <input type="number" placeholder="时长" name="time" value="<%= time %>" />',"        </div>",'        <div class="field">','            <label for="">排序</label>        ','            <input type="number" placeholder="排序" name="order" value="<%= order %>" />',"        </div>","    </div>",'            <input type="hidden" class="file-hidden" name="audioUrl"  value="<%= audioUrl %>" />','            <input type="hidden" class="file-hidden" name="urlMp3"  value="<%= urlMp3 %>" />','            <input type="hidden" class="file-hidden" name="shakelightUrl"  value="<%= shakelightUrl %>" />','            <input type="hidden" class="file-hidden" name="shakelightMp3"  value="<%= shakelightMp3 %>" />','            <input type="hidden" class="file-hidden" name="lyricUrl"  value="<%= lyricUrl %>" />','            <input type="hidden" class="file-hidden" name="surfaceImage"  value="<%= surfaceImage %>" />',"</form>"].join("");return{init:function(){var e=$(".mod-music-list");l(e)}}})