(function(e){"use strict";typeof define=="function"&&define.amd?define(e):e()})(function(){function e(e){this.options=_.extend({el:"",elSuggestBox:"",url:"",keyName:"key",ajaxType:"jsonp",baseParams:{key:"",page:1,limit:30},tmplSuggestItem:"",itemSelector:".item",onStart:function(){},onEnd:function(){},format:function(e){return e.data.resp.musics},itemFormat:function(e){return e},onItemSelect:function(e){}},e),this.$el=$(this.options.el),this.$elSuggestBox=$(this.options.elSuggestBox,this.$el),this.init()}return _.extend(e.prototype,{init:function(){this._bindEvents()},setOptions:function(e){if(!e)return this.options;$.extend(!0,this.options,e)},hideSuggestLayer:function(e){this.$elSuggestBox.hide()},showSuggestLayer:function(e){this.$elSuggestBox.show()},_bindEvents:function(){var e=this;this.$el.on("keydown",_.debounce(function(t){e.showSuggestLayer();var n=$.trim(e.getKeyValue());if(!n)return e.$elSuggestBox.empty();e._loadData()},672)),this.$el.on("focusin",function(e){$(this).trigger("keydown",e)}),this.$el.on("click",function(e){return e.stopPropagation(),e.preventDefault(),!1}),this.$elSuggestBox.on("click",function(e){return e.stopPropagation(),e.preventDefault(),!1}),this.$elSuggestBox.on("click",this.options.itemSelector,function(t){e.options.onItemSelect.call(e,this)}),$("body").on("click",function(){e.hideSuggestLayer()})},getKeyValue:function(){return this.$el.val()},_updateSuggestLayer:function(e){var t=this.options.tmplSuggestItem;this.$elSuggestBox.empty();if(e.length<=0){this.$elSuggestBox.append('<div style="padding: 10px; text-align: center">无数据</div>');return}for(var n=0;n<e.length;n++){var r=this.options.itemFormat.call(this,e[n]),i=_.template(t,r),s=$(i);this.$elSuggestBox.append(s)}},_loadData:function(){var e=this,t=this.options.url,n=this.options.baseParams;n[this.options.keyName]=this.getKeyValue(),$.ajax({url:t,dataType:this.options.ajaxType,data:n,timeout:12e3,beforeSend:function(){e.options.onStart.apply(e,arguments)},success:function(t,n){var r=e.options.format(t);e._updateSuggestLayer(r)},complete:function(){e.options.onEnd.apply(e,arguments)},fail:function(){}})}}),window.Suggestion=e,e})