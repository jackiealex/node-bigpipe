define(function(){function i(e){var t=RegExp(/^(0|86|17951)?(13[0-9]|15[012356789]|18[0-9]|14[57])[0-9]{8}$/).test(e);return t?!0:!1}function s(e){e.on("change",".choice",function(){var e=$(this).val();e==0?($(".reset-pwd").hide(),$(".register").show("slow"),t=0):($(".register").hide(),$(".reset-pwd").show("slow"),t=1)})}function o(s){s.on("click",".wrapper .getcode",function(o){r=this;var u=$(".wrapper input[type=text]").val();e=u;var a=i(u);if(a){$(r).attr("disabled",!0);var f=60;n=setInterval(function(){f--,$(r).val(f+"秒后再次获取"),f==0&&(clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),s.find(".msgresult").remove())},1e3),utils.api("/_bridge/sendverifycode",{method:"get",data:{phone:u,tag:t}}).done(function(e,t){if(e.node_code==2e4){var i=$('<p class="msgresult">验证码已发送,请注意查收!</p>');$(r).after(i)}else if(e.node_code==20003){var i=$('<p class="msgresult">用户不存在!</p>');$(r).after(i)}else clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),console.log("验证码获取失败")})}else alert("请输入正确的手机号码")})}function u(t){t.on("click",".register .submit",function(){var i=this,s=t.find(".register .pwd").val(),o=t.find(".register .repwd").val(),u=t.find(".register .validcode").val();s!=""&&o!=""&&u!=""&&s==o?utils.api("/_bridge/phoneregister",{method:"post",data:{phone:e,vcode:u,pwd:s}}).done(function(e,i){clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),e.node_code==20007&&e.msg=="user is exist"?(t.find(".register .register-result").html("用户已存在!").show(),t.find("input").not($("input[type=button]")).val(""),setTimeout(function(){t.find(".register .register-result").hide()},1e4)):e.node_code==2e4&&(t.find(".register .register-result").html("用户注册成功!").show(),t.find("input").not($("input[type=button]")).val(""),setTimeout(function(){t.find(".register .register-result").hide()},1e4))}):(alert("输入框为空或者两次输入的密码不一致!"),t.find("input").not($("input[type=button]")).val(""))})}function a(t){t.on("click",".reset-pwd .submit",function(){var i=this,s=t.find(".reset-pwd .newpwd").val(),o=t.find(".reset-pwd .renewpwd").val(),u=t.find(".reset-pwd .validcode").val();s!=""&&o!=""&&u!=""&&s==o?utils.api("/_bridge/resetpwd",{method:"post",data:{phone:e,vcode:u,pwd:s}}).done(function(e,i){e.node_code==2e4&&e.msg=="success"?(clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),t.find(".reset-pwd .reset-result").html("重置密码成功!").show(),t.find("input").not($("input[type=button]")).val(""),t.find(".msgresult").remove(),setTimeout(function(){t.find(".reset-pwd .reset-result").hide()},1e4)):e.node_code==20006?(clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),t.find(".reset-pwd .reset-result").html("验证码错误!").show(),t.find(".validcode").val(""),t.find(".msgresult").remove(),setTimeout(function(){t.find(".reset-pwd .reset-result").hide()},1e4)):(clearInterval(n),$(r).val("获取验证码").attr("disabled",!1),t.find(".reset-pwd .reset-result").html("密码重置失败!").show(),t.find(".validcode").val(""),t.find(".msgresult").remove())}):(alert("输入框为空或者两次输入的密码不一致!"),t.find("input").not($("input[type=button]")).val(""))})}var e="",t=0,n="",r;return{init:function(){var e=$(".mod-verify-box");o(e),s(e),u(e),a(e)}}})