define(function(){function t(t){t.on("click","table tr.row:not(.detail)",function(n){var r=$(this).data("id"),i=$(this).data("accompanyid"),s=$(this).find(".listener").data("id"),o=$(this).find(".singer").data("id"),u=t.find("tr.detail"),a=utils.loading(),f=this;$.when(utils.api("/_bridge/order/"+r+"/admin",{}),utils.api("/_bridge/accompany/"+i+"/admin",{}),utils.api("/_bridge/user/"+s+"/admin",{}),utils.api("/_bridge/user/"+o+"/admin",{})).done(function(t,n,r,i){var s=t.data.resp.order||{},o=n.data.resp.accompany||{},l=r.data.resp.user||{},c=i.data.resp.user||{},h=_.template(e)({order:s,accompany:o,listener:l,singer:c});$(h).insertAfter(f),u.remove(),a.remove()})}),t.on("click",".detail .close",function(e){$(this).hide(),$(this).parents("tr").find(".box").animate({height:0},300,function(e){$(this).parents("tr").remove()})})}function n(e){e.on("change",".header select",function(e){var t=$(this).parents(".header").find("input").val(),n=$(this).val();_SmartPipe_.location("/order/list?key="+t+"&status="+n)}),e.on("click",".header .button",function(e){var t=$(this).parents(".header").find("input").val(),n=$(this).parents().find("select").val();_SmartPipe_.location("/order/list?key="+t+"&status="+n)}),e.on("click",".header .input .remove",function(e){_SmartPipe_.location("/order/list")}),e.on("keyup",".header .input input",function(e){e.keyCode==13&&$(this).parents(".header").find(".button").trigger("click")})}function r(e){t(e),n(e)}var e=['<tr class="detail " data-id="<%= order.id %>">','    <td  colspan="7" style="padding: 0; height:10px" >','       <div class="triangle"></div>','        <div class="box">','            <div class="close">╳</div>',"            <ul>",'                <li class="u2u">','                    <div class="who">','                        <a href="http://share.vsingapp.com/profile/?uid=<%= listener.id %>" target="_blank"><img src="<%= listener.headPortrait %>" alt=""></a>','                        <div class="info">',"                           <p><%= listener.nickname || listener.username %></p>",'                           <p class="user-property"><span class="sex"><%= listener.gender = "male" ? "♂": "♀" %></span><%= listener.age %>岁</p>','                           <p class="user-property"><%= listener.astrological %></p>',"                        </div>","                    </div>",'                    <div class="txt-words">',"                    <% if(!order.song) { %>","                                想","                    <% } %>               ","                    听</div>",'                    <div class="who">','                        <a href="http://share.vsingapp.com/profile/?uid=<%= singer.id %>" target="_blank"><img src="<%= singer.headPortrait %>" alt=""></a>','                        <div class="info">',"                           <p><%= singer.nickname || singer.username %></p>",'                           <p class="user-property"><span class="sex"><%= singer.gender = "male" ? "♂": "♀" %></span><%= listener.age %>岁</p>','                           <p class="user-property"><%= singer.astrological %></p>',"                        </div>","                    </div>","                    <% if(!order.song) { %>",'                    <div class="txt-words end">唱歌</div>',"                    <% } else { %>               ",'                    <div class="txt-words end">','                    唱了一首歌《<a href="<%= order.song && order.song.fileUrl || accompany.audioUrl %>" target="_blank" ><%= accompany.name %></a>》（点击试听）',"                    </div>","                    <% } %>               ","                </li>","                <%if(order.comment) {%>",'                <li class="comment">',"                    <h4><%= listener.nickname %>说：</h4>","                    <p><%= order.comment %></p>","                </li>","                <%}%>",'                <li class="song">',"                    <h4>歌曲／伴奏／歌词</h4>","                    <p>",'                        <a href="<%= order.song && order.song.fileUrl%>" target="_blank">歌曲链接</a>','                        <a href="<%= accompany.audioUrl %>" target="_blank"><%= accompany.name %></a>','                        <a href="<%= accompany.lyricUrl %>" target="_blank">歌词</a>',"                    </p>","                </li>","                <li>",'                    <a class="green ui button" href="/chart/<%= order.id %>/detail">查看聊天</a>',"                </li>","            </ul>","        </div>","    </td>","</tr>"].join("");return{init:function(){var e=$(".mod-order-list");r(e)}}})