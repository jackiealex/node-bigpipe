define(function(){function n(e){e.on("click",".item .edit",function(e){var n=$(this).parents(".item"),r=n.data("id"),i=n.data("show"),s=n.find(".images a").attr("href"),o=n.find(".weight"),u=n.data("imageId"),a=o.text(),f=n.find(".images img").attr("src"),l=dialog({title:"修改",align:"bottom left",quickClose:!0,content:_.template(t,{id:r,file:f}),ok:function(){var e=$(this.node).find("input[type=file]");return e?($(this.node).find("form").ajaxSubmit({data:{id:r},beforeSubmit:function(){return loading=utils.loading(),!0},success:function(e,t){var o=e.data.resp.images[0].id;utils.api("/_bridge/admin/banner/update",{method:"post",data:{id:r,jumpUrl:s,weight:a,show:i,imageId:o}}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);loading.remove(),utils.bubble("修改成功"),n.find("img").eq(0).attr("src",dataURL)})},error:function(){}}),!0):(utils.bubble("请选择文件"),!1)},okValue:"提交",cancelValue:"取消",cancel:function(){return!0}});l.show(e.target)})}function r(t){t.on("click",".item .show,.item .weight",function(t){var n=$(this).parents(".item"),r=n.data("id"),i=n.data("show"),s=n.find(".images a").attr("href"),o=n.find(".weight"),u=n.data("imageId"),a=n.find(".show"),f=o.text(),l=dialog({title:"修改",align:"bottom left",quickClose:!0,content:_.template(e,{id:r,jumpUrl:s,weight:f}),onshow:function(){i==1&&$(this.node).find(".buttons .button:contains(禁用)").addClass("positive").siblings().removeClass("positive")},ok:function(){var e=$(this.node).find("input[name=id]").val(),t=$(this.node).find("input[name=jumpUrl]").val(),r=$(this.node).find("input[name=weight]").val(),i=$(this.node).find(".buttons .positive").data("id");return t?r?(utils.api("/_bridge/admin/banner/update",{method:"post",data:{id:e,jumpUrl:t,weight:r,show:i,imageId:u}}).done(function(e,s){if(e["node_code"]!=2e4)return utils.bubble(e.data.msg);o.text(r),t=n.find(".images a").attr("href"),i==0?showName="否":showName="是",a.text(showName),utils.bubble("修改成功")}),!0):(utils.bubble('请选择权重"'),!1):(utils.bubble("请选择目标链接"),!1)},okValue:"提交",cancelValue:"取消",cancel:function(){return!0}});l.show(t.target)})}function i(e){e.on("click",".item .del",function(e){var t=$(this);utils.api("/_bridge/admin/banner/delete",{method:"post",data:{id:t.data("id")}}).done(function(e,n){utils.bubble("删除成功！"),t.parents(".item").addClass("animated bounceOutLeft").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).remove()})})})}function s(e){i(e),r(e),n(e)}var e=['<div class="update-banner"> <input type="hidden" name="id" value="<%= id %>" >','	<div class="field">','		<div class="ui icon input">','			<input type="text" placeholder="目标链接" name="jumpUrl" value="<%= jumpUrl %>" >','			<i class="linkify icon"></i>',"		</div>","	</div><br/>",'	<div class="field">','		<div class="ui right icon input">','			<input type="number" min="1" placeholder="权重" name="weight" value="<%= weight %>" >','			<i class="resize vertical icon"></i>',"		</div>","	</div><br/>",'	<div class="field">','		<div class="ui buttons disable-status">','			<div class="ui button positive" data-id="0">激活</div>','			<div class="or"></div>','			<div class="ui button" data-id="1">禁用</div>',"		</div>","	</div>","</div>"].join(""),t=['<form action="/banner/updateimg" method="post">','   <div class="ui form"> <input type="hidden" name="id" value="<%= id %>" />','       <div class="field">','           <div class="ui-input-image-preview">','               <img src="/static/img/icons/image-uploader.png" alt="默认图片">','               <input type="file" name="file" title="选择文件" accept="image/*" >',"           </div>","       </div>","   </div>","</form>",'<link rel="stylesheet" href="/static/css/page/common/input-image-preview.css">'].join("");return{init:function(e){$scope=$(".mod-banner-list"),s($scope)}}})