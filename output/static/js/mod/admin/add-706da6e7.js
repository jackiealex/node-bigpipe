(function(){function e(e){uploader=WebUploader.create({swf:"/static/webuploader/Uploader.swf",server:"/upload/media",pick:"#picker",fileVal:"files",threads:4,fileNumLimit:12,formData:{__no_retain__:"ok",upload_file_server_path:"/admin/header/upload"},fileSingleSizeLimit:1e7,duplicate:!1,auto:!0,thumb:{width:400,height:400,crop:!0},compress:{width:200,height:200,crop:!0,preserveHeaders:!0,noCompressIfLarger:!0},accept:{title:"Images",extensions:"jpg,jpeg,bmp,png",mimeTypes:"image/*"}}),uploader.on("filesQueued",function(t){_.each(t,function(t,n){uploader.makeThumb(t,function(t,n){if(t)return;e.find("img").attr("src",n)})})}),uploader.on("uploadSuccess",function(t,n){n.node_code!==2e4&&e.find(".progress").find(".progress").addClass("warning");var r=n.data.resp.headUrl;e.find('.field input[name="headUrl"]').val(r),e.find(".progress").text("100%")}),uploader.on("uploadError",function(e,t){}),uploader.on("uploadProgress",function(t,n){e.find(".progress").text(n*62+"%")}),uploader.on("error",function(e){var t=this.getFiles().length;switch(e){case"Q_TYPE_DENIED":alert("错误的资源！");break;case"Q_EXCEED_NUM_LIMIT":utils.bubble("分批文件限制为"+t+"个！（可再次追加）");break;case"Q_EXCEED_SIZE_LIMIT":alert("文件体积过大");break;case"F_EXCEED_SIZE":alert("文件体积过大")}})}function t(e){e.on("click",".btn-submit",function(t){function l(){n.remove(),e.find('.field input[type="hidden"]').val(""),e.find("#picker img").attr("src","/static/img/icons/user.png"),e.find(".progress").html("点击上传头像"),uploader.reset()}var n=null,r=e.find('.field input[type="hidden"]'),i=e.find('.field input[name="username"]'),s=e.find('.field input[name="nickname"]'),o=e.find('.field input[name="email"]'),u=e.find('.field input[name="phone"]'),a=e.find('.field input[name="raw-password"]'),f=e.find('.field input[name="re-password"]');if(!i.val()){utils.bubble("请输入账号名！"),i.focus();return}if(a.val().length<6){utils.bubble("密码长度最少6位！"),a.focus();return}if(!a.val()||!f.val()){utils.bubble("请输入密码！");if(a.val()==""){a.focus();return}if(f.val()==""){f.focus();return}}if(a.val()!=f.val()){utils.bubble("确认密码不一致！"),f.focus();return}if(!s.val()){utils.bubble("请输入昵称！"),s.focus();return}if(!o.val()){utils.bubble("请输入邮箱！"),o.focus();return}if(!u.val()){utils.bubble("请输入手机号！"),o.focus();return}if(uploader.getStats().progressNum){utils.bubble("请等待图片上传完成！");return}if(!r.val()){if(uploader.getStats().progressNum){utils.bubble("请等待图片上传完成！");return}utils.bubble("请上传图片！");return}$("#FormAddAdmin").ajaxSubmit({beforeSerialize:function(){},beforeSubmit:function(e){return n=utils.loading(),e.push({name:"password",value:md5(a.val())}),!0},uploadProgress:function(){},success:function(e,t){if(e["node_code"]!=2e4){n.remove();switch(e.node_code){case 40302:utils.bubble("昵称重复！");break;case 40309:utils.bubble("用户名被占用！");break;default:utils.bubble(e.data.msg)}return}utils.bubble("提交成功"),l(),$("#FormAddAdmin").clearForm()},fail:function(e,t){l(),utils.bubble(rs.data.msg),$("#FormAddAdmin").clearForm()}})})}function n(e){t(e)}return{init:function(){var t=$(".form");e(t),n(t)}}})().init()