define(["mod/permission/fn-role-drop-handler"],function(e){function s(e){e.on("click",".btn-add",function(e){dialog({title:"添加角色",okValue:"提交",cancelValue:"取消",width:"500px",content:t,quickClose:!0,ok:function(){var e=$(this.node).find("input[name=name]").val(),t=$(this.node).find("input[name=content]").val();e=$.trim(e),t=$.trim(t);if(!e)return utils.bubble("请输入角色名"),!1;if(!t)return utils.bubble("请输入描述"),!1;utils.api("/_bridge/role",{method:"post",data:{name:e,description:t}}).done(function(e,t){e["node_code"]==2e4&&(_SmartPipe_.reload(),utils.bubble("添加成功"))})},cancel:function(){return!0}}).showModal(e.target)})}function o(e){e.on("click",".btn-editable",function(t){var n=e.find(".item.role");n.hasClass("editable")?n.removeClass("editable"):n.addClass("editable")})}function u(e){e.on("click",".btn-url-editable",function(t){if(e.find(".sub-mod-url .item.url .menu").length!=0)return e.find(".sub-mod-url .item.url .menu").remove();var n=['<div class="menu">','<div class="small red icon ui buttons menu">','   <div class="ui button update" title="编辑"><i class="edit icon"></i></div>','   <div class="ui button delete" title="删除"><i class="minus  icon"></i></div>',"</div>","</div>"].join(""),r=$(n);e.find(".sub-mod-url .item.url").append(r),e.find(".sub-mod-url .item.url .menu").addClass("animated bounceInUp")})}function a(e){e.on("click",".btn-url-addition",function(e){dialog({title:"新增权限",content:r,ok:function(){var e=$(this.node).find("form");if(!e[0].checkValidity())return utils.bubble("请检查表单信息"),!1;var t=e.find("input[name=path]").val();t=("/"+t).replace(/^\/+/g,"/"),$(this.node).find("form").ajaxSubmit({data:{url:t},success:function(e){if(e["node_code"]!=2e4)return utils.bubble("新增权限失败");utils.bubble("恭喜，新增权限成功!"),window._SmartPipe_.reload()},error:function(){}})},cancel:function(){return!0},okValue:"提交",cancelValue:"取消"}).width(500).showModal()})}function f(e){globFnWatchResize(function(t){e.find(".container").height(t.h-110)}),s(e),o(e),u(e),a(e)}var t=["<div>",'    <div class="ui fluid icon input">','        <input type="text" autofocus name="name" placeholder="角色名">','        <i class="home icon"></i>',"    </div> <br />",'    <div class="ui fluid icon input">','        <input type="text" name="content" placeholder="描述">','        <i class="text file icon"></i>',"    </div>","</div>"].join(""),n=["<div>",'    <div class="ui fluid icon input">','        <input  autofocus type="text" name="name" placeholder="角色名">','        <i class="home icon"></i>',"    </div> <br />",'    <div class="ui fluid icon input">','        <input type="text" name="content" placeholder="描述">','        <i class="text file icon"></i>',"    </div>","</div>"].join(""),n=["<div>",'    <div class="ui fluid icon input">','        <input autofocus type="text" name="name" placeholder="权限名">','        <i class="home icon"></i>',"    </div> <br />",'    <div class="ui fluid icon input">','        <input type="text" name="content" placeholder="描述">','        <i class="text file icon"></i>',"    </div>","</div>"].join(""),r=['<form action="/_bridge/admin/permission/url/add" method="post" required="required">','    <div class="row form ui" >  ','        <div class="field">','            <div class="ui icon input">','                <input autofocus type="text" required="required" placeholder="路径，如/admin/self/update" name="path">','                <i class="road icon"></i>',"            </div>","        </div>",'        <div class="field">','            <div class="ui right icon input">','                <input type="text"  required="required" placeholder="权限类型标示：label、atlas..." name="permissionContent">','                <i class="magnet icon"></i>',"            </div>","        </div>",'        <div class="field">','            <div class="ui right icon input">','                <input type="number" min="0"  required="required" max="1" placeholder="匹配模式 0-全匹配，1-正则匹配" name="level">','                <i class="lightning icon"></i>',"            </div>","        </div>",'        <div class="field">','            <textarea name="content" placeholder="描述一下本url是干什么的？"></textarea>',"        </div>","    </div>","</form>"].join(""),i=['<div class="item role">',"   <h2> 角色名：<span><%=name%></span>",'       <div class="small red icon ui buttons menu">','           <div class="ui button update" title="编辑"><i class="edit icon"></i></div>','           <div class="ui button delete" title="删除"><i class="minus  icon"></i></div>',"       </div>","       <p><%= content %></p> ","   </h2>",'    <ul data-id="<%= id %>">','        <li class="empty item">拖拽权限到这里！ </li>',"    </ul>","</div>"].join("");return{init:function(){debugger;var e=$(".mod-permission-manage");f(e)}}})