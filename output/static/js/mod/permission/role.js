define(["mod/permission/fn-role-drop-handler"],function(e){function n(e,t){utils.api("/_bridge/role?id="+e,{method:"delete",onError:function(e,n){t({node_code:null,msg:"server error"})}}).done(function(e,n){t(e)})}function r(t){t.find(".item ul").droppable({}).on("drop",e)}function i(e){e.on("click",".role .menu .delete",function(e){var t=$(this).parents(".role"),r=t.find("ul").data("id");dialog({title:"删除角色",quickClose:!0,align:"bottom",okValue:"提交",cancelValue:"取消",content:"操作类型为重要操作，请确认是否要继续？",ok:function(){n(r,function(e){if(e["node_code"]!=2e4)return utils.bubble("角色移除失败");t.addClass("animated zoomOut").one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){$(this).remove()}),utils.bubble("角色成功移除！"),_SmartPipe_.reload()})},cancel:function(){return!0}}).show(e.target)})}function s(e){e.on("click",".role .menu .settings",function(e){var t=$(this).parents(".role"),n=t.find("ul").data("id"),r=$(this).parents(".item").find(".item.url .btn-url-remove");r.show(),setTimeout(function(){r.hide()},3e3)})}function o(e){e.on("click",".role .btn-url-remove",function(e){var t=$(this).parents(".role"),n=t.find("ul").data("id"),r=$(this).parents("li").data("id");dialog({title:"慎重啊君！！！",align:"bottom",okValue:"确定",cancelValue:"取消",content:"此操作十分重要，请慎重执行！",ok:function(){utils.api("/_bridge/role/{id}/authorities?authId={authId}".replace("{id}",n).replace("{authId}",r),{method:"delete"}).done(function(e,t){if(e["node_code"]!=2e4)return utils.bubble(e.msg||e.err);utils.bubble("权限已经移除！"),window._SmartPipe_.reload()})},cancel:function(){return!0}}).showModal(e.target)})}function u(e){e.on("click",".role .menu .update",function(e){var n=$(this).parents(".role"),r=n.find("ul").data("id"),i=n.find("h2 span").text(),s=n.find("h2 p").text();dialog({title:"编辑角色",quickClose:!0,align:"bottom",okValue:"提交",cancelValue:"取消",content:_.template(t,{id:r,name:i,content:s}),ok:function(){var e=$(this.node).find("input[name=name]").val(),t=$(this.node).find("input[name=content]").val();$(this.node).find("form").ajaxSubmit({success:function(r){if(r["node_code"]!=2e4)return utils.bubble("角色更新失败");utils.bubble("角色已更新！"),n.find("h2 span").text(e),n.find("h2 p").text(t)},error:function(){}})},cancel:function(){return!0}}).show(e.target)})}function a(e){r(e),i(e),u(e),s(e),o(e)}var t=['<form action="/_bridge/role/update" method="post">',"<div>",'<input type="hidden" value="<%= id %>" name="id"  />','    <div class="ui fluid icon input">','        <input type="text" name="name" placeholder="角色名" value="<%= name %>" >','        <i class="home icon"></i>',"    </div> <br />",'    <div class="ui fluid icon input">','        <input type="text" name="description" placeholder="描述" value="<%= content %>">','        <i class="text file icon"></i>',"    </div>","</form>","</div>"].join("");return{init:function(){var e=$(".mod-permission-manage .sub-mod-role");debugger;a(e)}}})