define(function(){function t(e){e.on("click",".options .delete",function(e){var t=$(this).parents(".category-list-item"),n=t.data("id"),r=dialog({title:"您即将删除该兴趣分类",content:"确定删除?",okValue:"确定",cancelValue:"取消",ok:function(){utils.api("/_bridge/admin/interestcate/delete",{method:"post",data:{id:n}}).done(function(e,t){e["node_code"]==2e4&&(utils.bubble("删除成功"),_SmartPipe_.reload())})},cancel:function(){return!0}});r.showModal()})}function n(t){t.on("click",".options .edit",function(t){var n=$(this).parents(".category-list-item"),r=n.data("id"),i=dialog({title:"修改分类信息",content:"数据加载中......",okValue:"提交",cancelValue:"取消",onshow:function(){var t=this;utils.api("/_bridge/admin/interestcate/info",{data:{id:r}}).done(function(n){if(n["node_code"]==2e4){var r=n.data.resp.data;r.content=r.intro,t.content(_.template(e,r))}})},ok:function(){var e=$(this.node).find("input[name=id]").val(),t=$(this.node).find("input[name=imageFile]").val(),n=$(this.node).find("input[name=name]").val(),r=$(this.node).find("textarea[name=content]").val(),s=$(this.node).find("input[name=pid]").val()||0,o=$(this.node).find("input[name=createdtime]").val(),u=$(this.node).find("input[name=hot]").val(),a=$(this.node).find(".disable-status .positive").data("id");return r=$.trim(r),n=$.trim(n),n?r?(t?$(this.node).find("form").ajaxSubmit({beforeSubmit:function(){return loading=utils.loading(),!0},success:function(t,i){var o=t.data.resp.images[0].url;utils.api("/_bridge/admin/interestcate/update",{method:"post",data:{id:e,surfaceImg:o,name:n,intro:r,pid:s}}).done(function(e,t){e["node_code"]==2e4&&(utils.bubble("修改成功"),loading.remove(),_SmartPipe_.reload())})}}):utils.api("/_bridge/admin/interestcate/update",{method:"post",data:{id:e,name:n,intro:r,pid:s}}).done(function(e,t){e["node_code"]==2e4&&(utils.bubble("修改成功"),_SmartPipe_.reload())}),i.close(),!0):(utils.bubble("描述不能为空"),!1):(utils.bubble("名称不能为空"),!1)},cancel:function(){return!0}});i.showModal()})}function r(e){e.on("keyup",".input input",function(e){var t=$(this).val(),n=$(this).parent().data("type"),r=$(this).next(),i="/interestlabel/search?type="+n+"&name="+t;$(this).next().data("url",i),e.keyCode==13&&r.trigger("click")})}function i(e){e.on("click",".input i",function(e){var t=$(this).prev().val();if(!t)return e.stopPropagation(),e.preventDefault(),!1})}function s(e){e.on("click",".list-header .img-category-relation",function(e){return utils.openWindow({url:"/category/rel"})})}function o(e){s(e),n(e),t(e),r(e),i(e)}var e=['<form action="/category/updateimg" method="post">','<div class="basic-info" style="overflow: auto;">',"   <h4>如需修改图片请添加!</h4>",'   <div class="ui form"> <input type="hidden" name="id" value="<%= id %>" />','       <div class="field">','           <div class="ui-input-image-preview">','               <img src="/static/img/icons/image-uploader.png" alt="默认图片">','               <input type="file" name="imageFile" title="选择文件" accept="image/*" >',"           </div>","       </div>","   </div>","</div>",'<link rel="stylesheet" href="/static/css/page/common/input-image-preview.css">','<div class="two fields" style="display:inline-flex;width: 300px;">','   <div class="ui icon input field" style="width: 45%;margin-right: 4%;">','      <input type="text" name="name" placeholder="名称" value="<%= name %>">','        <i class="home  icon"></i>',"  </div>",'   <div class="ui icon input field" style="width: 45%;">','       <input type="text" name="pid" placeholder="父级" value="<%= pid %>" >','       <i class="male up  icon"></i>',"   </div>","</div>",'<div class="row description" style="margin-top:10px;">','   <div class="ui form" style="width: 280px;">','       <div class="field ui icon input">','           <textarea name="content" placeholder="描述一下"><%= content %></textarea>',"       </div>","   </div>","</div>","</form>"].join("");return{init:function(e){var t=$(".mod-interestlabel-list");o(t)}}})